[Unit]
Description=Kibana 6
BindsTo=probemanager.service
Wants=elasticsearch.service
After=elasticsearch.service
Wants=cassandra.service
After=cassandra.service
Wants=probemanager.service
Before=probemanager.service
Wants=probetransmogrifier.service
Before=probetransmogrifier.service

[Service]
Type=simple

User=nginx
Group=nginx

# Run ExecStartPre with root-permissions
PermissionsStartOnly=true

# Ensure KibanaStartup.log file exists and is owned by nginx
ExecStartPre=/usr/bin/touch /var/log/probe/KibanaStartup.log
ExecStartPre=/usr/bin/chown nginx:nginx /var/log/probe/KibanaStartup.log

Environment=CONFIG_PATH=/usr/local/kibana-6.6.0-linux-x86_64/config/kibana.yml
Environment=NODE_ENV=production

WorkingDirectory=/usr/local/kibana-6.6.0-linux-x86_64/

ExecStart=~/kibana-6.6.0-linux-x86_64/bin/kibana

ExecStartPost=/usr/bin/python /usr/local/kibana-6.6.0-linux-x86_64/scripts/setDefaultIndex.py
ExecStartPost=/usr/bin/python /usr/local/kibana-6.6.0-linux-x86_64/scripts/loadAssets.py

TimeoutStopSec=30

Restart=on-failure
RestartSec=10

[Install]
WantedBy=elasticsearch.service

